function Playground(e,t,n,r,i){this.canvasBox=document.getElementById("canvas");this.canvas=document.getElementById("canvas").getContext("2d");this.frozen=!1;this.runInterval;this.showBotStatus=!0;this.showBotStatusColor=!0;this.showGridLines=!1;this.showGridNumbers=!1;this.showBotNumbers=!1;this.teams=new Array;this.bots=new Array;this.defaultTeam;this.numTeams=n;this.numPlayers=r;this.botRadius=i;this.color={0:"blue",1:"red",2:"green",3:"yellow",4:"white",5:"black",6:"blue",7:"purple",8:"orange",9:"black"};this.names={0:"Cody",1:"Seve",2:"Number 2",3:"Lola",4:"Pippi",5:"Junior",6:"Dot",7:"Dash",8:"Teri",9:"Comma",10:"Spike",11:"Nemo",12:"Marley",13:"Chessie",14:"Tammie",15:"Michael",16:"Josh",17:"Kevin",18:"Kyle",19:"Lindsay",20:"Bert",21:"Eileen",22:"Pamela",23:"Dave",24:"Jeff",25:"Justin",26:"Blair",27:"Murphy",28:"Wendy",29:"Maverick",30:"Stetson",31:"Jodi",32:"Jim",33:"Tom",34:"Katherine",35:"Jeremy",36:"Mark",37:"Nick",38:"Mike"};this.neighborhoodRadius=10;this.gridSize=2*this.botRadius;e=parseInt(e);t=parseInt(t);this.width=e-e%this.gridSize;this.height=t-t%this.gridSize;this.numRows=this.height/this.gridSize;this.numCols=this.width/this.gridSize;this.framesPerGridStep=this.gridSize;this.frameCount=e;this.stepsPerSecond=1;this.leaveForMeetingThreshold=10;this.missedMeetingThreshold=10;this.meetingCycleLength=30;this.meetNoShowBots=!1;this.meetTeamMembers=!1;this.showBotNames=!0;this.showMeetingConnectors=!0;this.sprites={};this.spriteImage=new Image;this.spriteImage.src="images/sprites/mario.png";this.canvas.drawImage(this.spriteImage,0,0,50,50,0,0,50,50)}Playground.prototype.animate=function(){if(!this.frozen){this.advanceFrame();this.draw()}};Playground.prototype.draw=function(){this.requestAnimFrame(function(){this.animate()})};Playground.prototype.requestAnimFrame=function(e){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||window.setTimeout(e,1e3/60)};Playground.prototype.getRandomLocation=function(){var e=new Location;e.xCoord=Math.floor(Math.random()*this.numCols);e.yCoord=Math.floor(Math.random()*this.numRows);return e};Playground.prototype.getRandomTime=function(){var e=new Date,t=e.getTime();return t+Math.floor(Math.random()*12e4+6e4)};Playground.prototype.isGridLocationOutOfBounds=function(e){return e.xCoord<0||e.yCoord<0||e.xCoord>this.numCols-1||e.yCoord>this.numRows-1?!0:!1};Playground.prototype.isGridLocationOccupied=function(e){if(this.isGridLocationOutOfBounds(e))return!0;for(var t=0;t<this.bots.length;t++)if(locationsAreEqual(this.bots[t].gridPosition,e))return!0;return!1};Playground.prototype.getNextDoorNeighbors=function(e){return this.getNeighborsWithinRadius(e,1)};Playground.prototype.getNeighborhood=function(e){return this.getNeighborsWithinRadius(e,this.neighborhoodRadius)};Playground.prototype.getNeighborsWithinRadius=function(e,t){var n=Array();for(var r=0;r<this.bots.length;r++)this.bots[r]!=e&&getNumSteps(e.gridPosition,this.bots[r].gridPosition)<=t&&n.push(this.bots[r]);return n};Playground.prototype.nextMeeting=function(){return meetings[0]};Playground.prototype.createTeams=function(){var e=1,t=Math.floor(this.numRows/(this.numTeams+1)),n=Math.floor(this.numCols/(this.numPlayers+1));for(var r=1;r<=this.numTeams;r++){var i=new Team("Team"+r,new GridLocation(Math.floor(this.numCols/2),t*r),this,this.color[r-1]);for(var s=1;s<=this.numPlayers;s++){var o=new GridLocation(n*s,i.base.yCoord),u=new Bot(this.radius,o,i,this,e);this.bots.push(i.addBot(u));e++}this.teams.push(i)}};Playground.prototype.pauseBot=function(){};Playground.prototype.setup=function(){this.createTeams();this.clear();this.drawGround();this.updateSimSettings()};Playground.prototype.play=function(){this.setup()};Playground.prototype.advanceLoop=function(){for(;;)this.advanceFrame()};Playground.prototype.start=function(){this.setup();this.animate()};Playground.prototype.pause=function(){};Playground.prototype.advanceFrame=function(){if(this.frameCount>this.framesPerGridStep){this.frameCount=1;this.frameTranslations=new Array;for(var e=0;e<this.bots.length;e++){var t=new Translation(this.bots[e].gridPosition,null);this.bots[e].tryToMoveBot();t.toGridLocation=this.bots[e].gridPosition;this.frameTranslations[this.bots[e].botNumber]=t}}for(var e=0;e<this.bots.length;e++){var t=this.frameTranslations[this.bots[e].botNumber];this.moveBotForFrame(this.bots[e],t,this.frameCount)}this.frameCount++;this.redraw()};Playground.prototype.moveBotForFrame=function(e,t,n){var r=0,i=0;t.fromGridPosition.xCoord<t.toGridLocation.xCoord?r=1:t.fromGridPosition.xCoord>t.toGridLocation.xCoord&&(r=-1);t.fromGridPosition.yCoord>t.toGridLocation.yCoord?i=-1:t.fromGridPosition.yCoord<t.toGridLocation.yCoord&&(i=1);var s=this.convertGridToReal(t.fromGridPosition);s.xCoord=s.xCoord+r*n;s.yCoord=s.yCoord+i*n;e.moveBotToPixel(s)};Playground.prototype.advance=function(){for(var e=0;e<this.framesPerGridStep;e++)this.advanceFrame()};Playground.prototype.redraw=function(){this.clear();this.drawGround();this.drawBots()};Playground.prototype.clear=function(){this.canvas.clearRect(0,0,this.width,this.height)};Playground.prototype.getSprite=function(e){if(e=="mario"){if(this.sprites["mario"]==null){this.sprites.mario=new Sprite("images/sprites/mario.png",marioSpriteMap,5);return this.sprites.mario}return this.sprites.mario}return};Playground.prototype.drawFlippedImage=function(e,t,n,r,i,s,o,u,a,f){if(f){this.canvas.save();this.canvas.translate(s-u*.5,o-a*.5);this.canvas.scale(-1,1);this.canvas.drawImage(e,t,n,r,i,s-u*.5,o-a*.5,u,a);this.canvas.restore()}else this.canvas.drawImage(e,t,n,r,i,s-u*.5,o-a*.5,u,a)};Playground.prototype.drawSprite=function(e){var t=this.getSprite(e.botType);t==null&&console.log("sprite is null ");var n=Math.ceil(this.framesPerGridStep/t.spritesPerGridStep),r=Math.floor((this.frameCount-1)/n),i=e.actualHeading;if(i=="45"){i="315";flip=!0}else if(i=="270"){i="90";flip=!0}else if(i=="135"){i="225";flip=!0}else flip=!1;r==3?r=1:r==4&&(r=0);typeof t.map=="undefined"?console.log("sprite.map undefined"):typeof t.map[i+"_"+r].begin.xCoord=="undefined"&&console.log("begin.xCoord undefined");var s=t.map[i+"_"+r].begin.xCoord,o=t.map[i+"_"+r].begin.yCoord,u=Math.abs(s-t.map[i+"_"+r].end.xCoord),a=Math.abs(o-t.map[i+"_"+r].end.yCoord);this.drawFlippedImage(t.image,s,o,u,a,f,l,c,h,flip);var f=e.pixelPosition.xCoord,l=e.pixelPosition.yCoord,c=this.botRadius,h=this.botRadius;this.canvas.drawImage(t.image,s,o,u,a,f,l,c,h)};Playground.prototype.drawGround=function(){this.canvasBox.setAttribute("height",this.height);this.canvasBox.setAttribute("width",this.width);this.canvas.beginPath();this.canvas.rect(0,0,this.width,this.height);this.canvas.fillStyle="#FFFFFF";this.canvas.fill();this.canvas.lineWidth=0;this.canvas.strokeStyle="black";this.canvas.stroke();if(this.showGridLines){for(var e=1;e<this.numCols;e++){var t=this.height/this.numRows*e;this.canvas.beginPath();this.canvas.lineWidth=1;this.canvas.moveTo(0,t);this.canvas.lineTo(this.width,t);this.canvas.stroke()}for(var e=1;e<this.numRows;e++){var n=this.width/this.numCols*e;this.canvas.beginPath();this.canvas.moveTo(n,0);this.canvas.lineTo(n,this.height);this.canvas.stroke()}}};Playground.prototype.drawBot=function(e){if(!e)return!1;var t=e.pixelPosition,n=e.team.color,r;if(e.inMeeting){r="IN A MEETING DND -  "+e.meetingCycleCount;var i="red"}else if(e.waitingForMeeting){r="WAITING - "+e.timeToNextMeeting()+" s";var i="orange"}else if(e.onWayToMeeting){r="ON MY WAY "+e.timeToNextMeeting()+" s";var i="yellow"}else{r="WALKIN AROUND GETTIN INVOLVED - "+e.timeToNextMeeting()+" s";var i="green"}if(this.showBotStatus){this.canvas.font="8px sans-serif";this.canvas.fillStyle="black";this.canvas.fillText(r,t.xCoord,t.yCoord-2*this.botRadius)}this.showBotStatusColor&&(n=i);if(this.showBotNames){this.canvas.font="7px sans-serif";this.canvas.fillStyle="black";this.canvas.fillText(this.names[(e.botNumber-1)%38],t.xCoord,t.yCoord+this.botRadius)}if(this.showMeetingConnectors&&e.nextMeeting()){var s=e.nextMeeting().otherBot;this.canvas.beginPath();this.canvas.moveTo(t.xCoord,t.yCoord);this.canvas.lineTo(s.pixelPosition.xCoord,s.pixelPosition.yCoord);this.canvas.stroke()}if(this.showBotNumbers){this.canvas.font="7px sans-serif";this.canvas.fillStyle="black";this.canvas.fillText(e.botNumber,t.xCoord-2,t.yCoord+2)}if(e.botType=="circleBot"){this.canvas.beginPath();this.canvas.arc(t.xCoord,t.yCoord,this.botRadius,0,2*Math.PI,!1);this.canvas.fillStyle=n;this.canvas.fill();this.canvas.lineWidth=1;this.canvas.strokeStyle=e.team.color;this.canvas.stroke()}else this.drawSprite(e)};Playground.prototype.drawBots=function(){for(var e=0;e<this.bots.length;e++)this.drawBot(this.bots[e])};Playground.prototype.convertGridToReal=function(e){var t=new PixelLocation;t.xCoord=e.xCoord*this.gridSize+this.gridSize/2;t.yCoord=e.yCoord*this.gridSize+this.gridSize/2;return t};Playground.prototype.updateSimSettings=function(){$("#cbShowBotStatus").is(":checked")?this.showBotStatus=!0:this.showBotStatus=!1;this.showBotStatusColor=$("#cbShowBotStatusColors").is(":checked");$("#cbShowBotNumbers").is(":checked")?this.showBotNumbers=!0:this.showBotNumbers=!1;$("#cbShowGridlines").is(":checked")?this.showGridLines=!0:this.showGridLines=!1;$("#cbMeetTeamMembers").is(":checked")?this.meetTeamMembers=!0:this.meetTeamMembers=!1;$("#cbMeetNoShowBots").is(":checked")?this.meetNoShowBots=!0:this.meetNoShowBots=!1;this.showMeetingConnectors=$("#cbShowMeetingConnectors").is(":checked");this.showBotNames=$("#cbShowBotNames").is(":checked");this.leaveForMeetingThreshold=parseInt($("#tExtraTravelTime").val());this.missedMeetingThreshold=parseInt($("#tMeetWaitTime").val());this.meetingCycleLength=parseInt($("#tMeetingLength").val());this.showGridLines=$("#cbShowGridlines").is(":checked")};